import{i as _}from"./index-xLNEZWib.js";import{I as g}from"./icon-DPS44qRJ.js";import{h as m,u as h,k as f,B as A,x as l,y as E}from"./constants-DbTVzGEo.js";import{W as v}from"./with-label-aware-DCBgJY4W.js";import{W as S,a as y}from"./with-element-internals-OwbKVFX0.js";import{F as d,B as T}from"./base-adapter-RV6G8GOJ.js";import{F as L}from"./focus-indicator-DAACHSkM.js";import"./index-Dh0vMUMR.js";import{S as O}from"./state-layer-CqUt3N3R.js";import{t as I}from"./event-utils-CtHj37Lc.js";const P=["name","value","formaction","formenctype","formmethod","formnovalidate","formtarget"];function k(r,t,o){o.forEach(e=>{const s=r.getAttribute(e);s!==null&&t.setAttribute(e,s)})}const b={TYPE:"type",DISABLED:"disabled",POPOVER_ICON:"popover-icon",DENSE:"dense",TABINDEX:"tabindex"},D={...b},C={ROOT:"forge-button",POPOVER_ICON:"forge-button__popover-icon",WITH_ANCHOR:"with-anchor"},N={ROOT:"[part=root]",DEFAULT_SLOT:"slot:not([name])",END_SLOT:"slot[name=end]"},i={observedAttributes:b,attributes:D,selectors:N,classes:C};var B=Object.defineProperty,p=(r,t,o,e)=>{for(var s=void 0,n=r.length-1,a;n>=0;n--)(a=r[n])&&(s=a(t,o,s)||s);return s&&B(t,o,s),s};const u=class u extends S(y(v(A))){constructor(){super(),this.popoverTargetElement=null,this.popoverTargetAction="click",g.define(_)}static get observedAttributes(){return Object.values(i.observedAttributes)}connectedCallback(){this._foundation.initialize()}attributeChangedCallback(t,o,e){switch(t){case i.observedAttributes.TYPE:this.type=e;return;case i.observedAttributes.DISABLED:this.disabled=m(e);return;case i.observedAttributes.POPOVER_ICON:this.popoverIcon=m(e);return;case i.observedAttributes.DENSE:this.dense=m(e);return}}labelClickedCallback(){this._foundation.click({animateStateLayer:!0})}labelChangedCallback(t){this[h]({ariaLabel:t},{setAttribute:!this.hasAttribute("aria-label")})}get form(){return this[f].form}get name(){return this.getAttribute("name")??""}set name(t){this.setAttribute("name",t)}get value(){return this.getAttribute("value")??""}set value(t){this.setAttribute("value",t)}click(){this._foundation.click({animateStateLayer:!0})}focus(t){this._foundation.focus(t)}};u.formAssociated=!0;let c=u;p([d()],c.prototype,"type");p([d()],c.prototype,"disabled");p([d()],c.prototype,"popoverIcon");p([d()],c.prototype,"dense");class Y extends T{constructor(t){super(t),this._rootElement=l(this._component,i.selectors.ROOT),this._focusIndicatorElement=l(this._component,L.elementName),this._stateLayerElement=l(this._component,O.elementName),this._defaultSlotElement=l(this._component,i.selectors.DEFAULT_SLOT),this._endSlotElement=l(this._component,i.selectors.END_SLOT)}get hasSlottedAnchor(){return!!this.getSlottedAnchor}get getSlottedAnchor(){return this._defaultSlotElement.assignedElements({flatten:!0}).find(t=>t.tagName==="A")}initialize(){const t=this.getSlottedAnchor;this._component[h]({role:t?null:"button"},{setAttribute:!this._component.hasAttribute("role")||!!t}),this._rootElement.classList.toggle(i.classes.WITH_ANCHOR,!!t),t?this._component.removeAttribute("tabindex"):!this._component.disabled&&!this._component.hasAttribute("tabindex")&&this._component.setAttribute("tabindex","0"),this._focusIndicatorElement.targetElement=t||this._component,this._stateLayerElement.targetElement=t||this._component}setDisabled(t){t?(this._focusIndicatorElement.remove(),this._stateLayerElement.remove()):this._rootElement.append(this._focusIndicatorElement,this._stateLayerElement),this.hasSlottedAnchor?(this._component.removeAttribute("tabindex"),this._component[h]({ariaDisabled:null},{setAttribute:!0})):(t?this._component.removeAttribute("tabindex"):this._component.setAttribute("tabindex","0"),this._component[h]({ariaDisabled:t?"true":null}))}clickHost(){HTMLElement.prototype.click.call(this._component)}forceFocusVisible(){this._focusIndicatorElement.active=!0}clickFormButton(t){var o;if(this._component.form)if(t==="submit"){this._component[f].setFormValue(this._component.value);const e=document.createElement("button");e.type=t,k(this._component,e,P),this._component.form.addEventListener("submit",s=>{Object.defineProperty(s,"submitter",{configurable:!0,enumerable:!0,get:()=>this._component})},{capture:!0,once:!0}),this._component.insertAdjacentElement("afterend",e),e.click(),e.remove()}else t==="reset"&&((o=this._component.form)==null||o.reset())}hasPopoverTarget(){return this._component.hasAttribute("popovertarget")||!!this._component.popoverTargetElement}managePopover(){if(this._component.form||!this.hasPopoverTarget()||!E())return!1;const t=this._locatePopoverTargetElement();if(!t)return!1;const o=this._component.getAttribute("popovertargetaction")??this._component.popoverTargetAction??"toggle",e=t.matches(":popover-open");switch(o){case"show":return e||t.showPopover(),!0;case"hide":return e&&t.hidePopover(),!1;case"toggle":default:const s=t.togglePopover();if(s&&t.popover!=="manual"){const n=a=>{a.stopPropagation(),t.matches(":popover-open")&&t.hidePopover()};this._component.addEventListener("click",n,{capture:!0,once:!0}),t.addEventListener("beforetoggle",async()=>{await new Promise(a=>setTimeout(a)),this._component.removeEventListener("click",n,{capture:!0})},{once:!0})}return s}}toggleDefaultPopoverIcon(t){if(t){if(!this._endSlotElement.querySelector("forge-icon")){const e=document.createElement("forge-icon");e.classList.add(i.classes.POPOVER_ICON),e.name=_.name,this._endSlotElement.append(e)}}else{const o=this._endSlotElement.querySelector("forge-icon");o==null||o.remove()}}animateStateLayer(){var t;this._stateLayerElement.disabled||(t=this._stateLayerElement)==null||t.playAnimation()}addDefaultSlotChangeListener(t){this._defaultSlotElement.addEventListener("slotchange",t)}_locatePopoverTargetElement(){let t=this._component.popoverTargetElement??null;if(!t){const o=this._component.ownerDocument.getRootNode();if(!o)return null;const e=this._component.getAttribute("popovertarget");t=o.querySelector(`#${e}`)}return t}}class q{constructor(t){this._adapter=t,this._type="button",this._disabled=!1,this._popoverIcon=!1,this._dense=!1,this._clickListener=this._onClick.bind(this),this._keydownListener=this._onKeydown.bind(this),this._slotChangeListener=()=>this._detectSlottedAnchor()}initialize(){this._detectSlottedAnchor(),this._adapter.addDefaultSlotChangeListener(this._slotChangeListener)}click({animateStateLayer:t=!1}={}){this._disabled||(this._adapter.clickHost(),t&&this._adapter.animateStateLayer())}focus(t){this._adapter.focusHost(t),(t==null?void 0:t.focusVisible)!==!1&&this._adapter.forceFocusVisible()}async _onClick(t){const o=this._type==="submit"||this._type==="reset";!o&&this._adapter.hasPopoverTarget()&&this._adapter.managePopover()||(await new Promise(e=>setTimeout(e)),!(t.defaultPrevented||this._disabled)&&o&&this._adapter.clickFormButton(this._type))}async _onKeydown(t){if(t.key===" "){t.preventDefault(),this.click();return}await I(),!(t.defaultPrevented||this._disabled)&&t.key==="Enter"&&this.click()}_detectSlottedAnchor(){this._adapter.hasSlottedAnchor?(this.disabled=!1,this._adapter.removeHostListener("click",this._clickListener),this._adapter.removeHostListener("keydown",this._keydownListener)):(this._adapter.addHostListener("click",this._clickListener),this._adapter.addHostListener("keydown",this._keydownListener)),this._adapter.initialize()}get type(){return this._type}set type(t){this._type!==t&&(this._type=t,this._adapter.setHostAttribute(i.attributes.TYPE,t))}get disabled(){return this._disabled}set disabled(t){t=!!t,this._disabled!==t&&(this._adapter.hasSlottedAnchor&&(t=!1),this._disabled=t,this._adapter.setDisabled(this._disabled),this._adapter.toggleHostAttribute(i.attributes.DISABLED,t))}get popoverIcon(){return this._popoverIcon}set popoverIcon(t){t=!!t,this._popoverIcon!==t&&(this._popoverIcon=t,this._adapter.toggleDefaultPopoverIcon(this._popoverIcon),this._adapter.toggleHostAttribute(i.attributes.POPOVER_ICON,t))}get dense(){return this._dense}set dense(t){t=!!t,this._dense!==t&&(this._dense=t,this._adapter.toggleHostAttribute(i.attributes.DENSE,t))}}export{Y as B,q as a,c as b,i as c};
